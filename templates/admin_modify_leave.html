{% extends "base.html" %}

{% block content %}
<link rel="stylesheet" href="/static/style.css?v=3">

<div class="container">
    <h1 class="center-text">‚úèÔ∏è Modify Leave</h1>

    <!-- Employee Selection Form -->
    <form method="get" action="/admin/modify-leave" class="report-form">
        <label for="employee_id">Select Employee:</label>
        <select name="employee_id" id="employeeSelect" class="styled-select" onchange="this.form.submit()">
            <option value="">-- Select --</option>
            {% for user in users %}
                <option value="{{ user.id }}" {% if selected_id == user.id %}selected{% endif %}>
                    {{ user.name }}
                </option>
            {% endfor %}
        </select>

        <label for="per_page">Per Page:</label>
        <select name="per_page" onchange="this.form.submit()">
            <option value="5" {% if per_page == 5 %}selected{% endif %}>5</option>
            <option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
            <option value="25" {% if per_page == 25 %}selected{% endif %}>25</option>
            <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
        </select>
    </form>

    {% if leaves %}
        <h3>Assigned Leaves:</h3>
        <table class="styled-table">
            <thead>
                <tr>
                    <th>Type</th>
                    <th>Start</th>
                    <th>End</th>
                    <th>Days</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for leave in leaves %}
                <tr>
                    <td>{{ leave.comment }}</td>
                    <td>{{ leave.start_date }}</td>
                    <td>{{ leave.end_date }}</td>
                    <td>{{ (leave.end_date - leave.start_date).days + 1 }}</td>
                    <td style="display: flex; gap: 0.5rem;">
                        <!-- Delete Button -->
                        <form method="post" action="/admin/delete-leave/{{ leave.id }}" onsubmit="return confirm('Delete this leave?')">
                            <button type="submit" class="delete-button" title="Delete Leave">üóëÔ∏è</button>
                        </form>

                        <!-- Edit Button -->
                        <form method="get" action="/admin/edit-leave/{{ leave.id }}">
                            <button type="submit" class="edit-button" title="Edit Leave">‚úèÔ∏è</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Pagination Controls -->
        <div class="pagination">
            {% if page > 1 %}
                <a href="?employee_id={{ selected_id }}&page={{ page - 1 }}&per_page={{ per_page }}">&laquo; Prev</a>
            {% endif %}

            {% for p in range(1, total_pages + 1) %}
                {% if p == page %}
                    <span class="current-page">{{ p }}</span>
                {% else %}
                    <a href="?employee_id={{ selected_id }}&page={{ p }}&per_page={{ per_page }}">{{ p }}</a>
                {% endif %}
            {% endfor %}

            {% if page < total_pages %}
                <a href="?employee_id={{ selected_id }}&page={{ page + 1 }}&per_page={{ per_page }}">Next &raquo;</a>
            {% endif %}
        </div>
    {% endif %}

    <div class="center-text margin-top">
        <a href="/admin/leave-dashboard" class="back-link">‚Üê Back</a>
    </div>
</div>
{% endblock %}
